# Лабораторная работа 10: Time Series Database с использованием Prometheus

## Описание
В данной лабораторной работе создано приложение-экспортер для сбора метрик об использовании системных ресурсов. Экспортер написан на языке Python с использованием библиотеки `prometheus_client`. Метрики собираются и отображаются в формате, совместимом с Prometheus.

Дополнительно разработан файл конфигурации для Prometheus, позволяющий собирать метрики от экспортера.

---

## Функционал экспортера
Экспортер собирает следующие метрики:
- **Использование процессоров**: процент использования каждого ядра процессора.
- **Оперативная память**: общий объём и объём используемой памяти.
- **Диски**: общий объём и объём занятого места.

### Метрики и их описание:
- `cpu_usage_percentage{core}`: Процент использования процессора (для каждого ядра).
- `memory_total_bytes`: Общий объём оперативной памяти в байтах.
- `memory_used_bytes`: Используемый объём оперативной памяти в байтах.
- `disk_total_bytes`: Общий объём дисков в байтах.
- `disk_used_bytes`: Используемое место на дисках в байтах.

Метрики доступны по корневому пути `/`.

### Переменные окружения
- **EXPORTER_HOST**: Адрес, на котором работает экспортер. По умолчанию — `localhost`.
- **EXPORTER_PORT**: Порт, на котором работает экспортер. По умолчанию — `8000`.

---

## Установка и запуск

### Требования
- Python 3.7+
- Установленные зависимости из `requirements.txt`:
  ```bash
  pip install psutil prometheus_client
  ```

### Запуск экспортера
1. Задайте переменные окружения (опционально):
   ```bash
   set EXPORTER_HOST= your_host
   set EXPORTER_PORT= your_port
   ```
2. Запустите экспортёр:
   ```bash
   python main.py
   ```

---

## Конфигурация Prometheus
Пример конфигурации для Prometheus:
```yaml
scrape_configs:
  - job_name: "system_metrics"
    static_configs:
      - targets: ["localhost:8000"]
```

С примером конфигурационного файла можно ознакомиться  в директории *./prometheus_info/prometheus.yml*

---

## Запросы на PromQL

### Использование процессоров
- **Средняя загрузка ядер процессора:**
```promql
avg by (core) (cpu_usage_percentage)
```

### Использование оперативной памяти
- **Всего памяти:**
  ```promql
  memory_total_bytes
  ```
- **Используемая память:**
  ```promql
  memory_used_bytes
  ```

### Использование дисков
- **Общий объём дисков:**
  ```promql
  disk_total_bytes
  ```
- **Используемое место на дисках:**
  ```promql
  disk_used_bytes
  ```

---

## Результаты
- Приложение-экспортер для сбора метрик.
- Файл конфигурации для Prometheus.
---

